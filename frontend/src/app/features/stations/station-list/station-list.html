<div class="space-y-6">
	<div class="flex flex-col gap-4 md:flex-row md:items-center md:justify-between">
		<div>
			<h1 class="text-2xl font-semibold text-gray-900 dark:text-slate-100">Stations</h1>
			<p class="text-sm text-gray-500 dark:text-slate-400">Manage charging stations and availability.</p>
		</div>

		<div class="flex items-center gap-3">
			<button
				type="button"
				(click)="refresh()"
				class="inline-flex items-center gap-2 rounded-lg border border-gray-200 px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800"
			>
				Refresh
			</button>
			<a
				routerLink="/stations/new"
				class="inline-flex items-center gap-2 rounded-lg bg-blue-600 px-4 py-2 text-sm font-medium text-white hover:bg-blue-700 dark:bg-blue-500 dark:hover:bg-blue-600"
			>
				+ New Station
			</a>
		</div>
	</div>

	<form [formGroup]="filtersForm" class="rounded-xl border border-gray-200 bg-white p-4 shadow-sm dark:border-slate-700 dark:bg-slate-900">
		<div class="grid gap-4 md:grid-cols-2 xl:grid-cols-4">
			<div>
				<label class="text-xs font-medium text-gray-500 dark:text-slate-400">City</label>
				<input
					type="text"
					formControlName="city"
					placeholder="Search city"
					class="mt-2 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"
				/>
			</div>

			<div>
				<label class="text-xs font-medium text-gray-500 dark:text-slate-400">Status</label>
				<select
					formControlName="status"
					class="mt-2 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"
				>
					<option value="">All</option>
					@for (status of stationStatuses; track status) {
						<option [value]="status">{{ status }}</option>
					}
				</select>
			</div>

			<div>
				<label class="text-xs font-medium text-gray-500 dark:text-slate-400">Charger type</label>
				<select
					formControlName="chargerType"
					class="mt-2 w-full rounded-lg border border-gray-200 px-3 py-2 text-sm focus:border-blue-500 focus:outline-none dark:border-slate-700 dark:bg-slate-900 dark:text-slate-100"
				>
					<option value="">All</option>
					@for (type of chargerTypes; track type) {
						<option [value]="type">{{ type }}</option>
					}
				</select>
			</div>
		</div>

		<div class="mt-4 rounded-lg border border-gray-100 bg-gray-50 p-4 dark:border-slate-700 dark:bg-slate-950">
			<div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
				<div>
					<p class="text-sm font-medium text-gray-700 dark:text-slate-200">Location filter</p>
					<p class="text-xs text-gray-500 dark:text-slate-400">Use your current position to filter nearby stations.</p>
				</div>
				<div class="flex items-center gap-2">
					<button
						type="button"
						(click)="useMyLocation()"
						class="rounded-lg border border-gray-200 px-3 py-2 text-xs font-medium text-gray-700 hover:bg-gray-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800"
					>
						@if (geoStatus() === 'locating') {
							Locating...
						} @else {
							Use my location
						}
					</button>
					<button
						type="button"
						(click)="clearLocation()"
						class="rounded-lg border border-gray-200 px-3 py-2 text-xs font-medium text-gray-600 hover:bg-gray-50 dark:border-slate-700 dark:text-slate-300 dark:hover:bg-slate-800"
					>
						Clear
					</button>
				</div>
			</div>

			@if (geoError()) {
				<p class="mt-2 text-xs text-red-600 dark:text-red-300">{{ geoError() }}</p>
			}

			<div class="mt-4 grid gap-4 md:grid-cols-2">
				<div>
					<label class="text-xs font-medium text-gray-500 dark:text-slate-400">Radius (km)</label>
					<input
						type="range"
						min="1"
						max="50"
						step="1"
						[disabled]="geoStatus() !== 'ready'"
						[value]="(filtersForm.controls.radius.value || 10000) / 1000"
						(input)="filtersForm.controls.radius.setValue($any($event.target).value * 1000)"
						class="mt-2 w-full accent-blue-600"
					/>
					<p class="mt-1 text-xs text-gray-500 dark:text-slate-400">
						@if (geoStatus() === 'ready') {
							{{ (filtersForm.controls.radius.value || 10000) / 1000 }} km
						} @else {
							Enable location to set radius
						}
					</p>
				</div>
			</div>
		</div>

		<div class="mt-4 flex items-center justify-end gap-3">
			<button
				type="button"
				(click)="resetFilters()"
				class="rounded-lg border border-gray-200 px-3 py-2 text-sm font-medium text-gray-600 hover:bg-gray-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800"
			>
				Reset
			</button>
		</div>
	</form>

	@if (errorMessage()) {
		<div class="rounded-lg border border-red-200 bg-red-50 px-4 py-3 text-sm text-red-700 dark:border-red-500/40 dark:bg-red-500/10 dark:text-red-200">
			{{ errorMessage() }}
		</div>
	}

	<div class="rounded-xl border border-gray-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-900">
		<div class="overflow-x-auto">
			<table class="min-w-full divide-y divide-gray-200 dark:divide-slate-700">
				<thead class="bg-gray-50 text-left text-xs font-semibold uppercase tracking-wide text-gray-500 dark:bg-slate-950 dark:text-slate-400">
					<tr>
						<th class="px-6 py-3">Station</th>
						<th class="px-6 py-3">City</th>
						<th class="px-6 py-3">Status</th>
						<th class="px-6 py-3">Chargers</th>
						<th class="px-6 py-3">Operator</th>
						<th class="px-6 py-3 text-right">Actions</th>
					</tr>
				</thead>
				<tbody class="divide-y divide-gray-100 text-sm dark:divide-slate-800">
					@if (loading()) {
						<tr>
							<td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-slate-400">
								Loading stations...
							</td>
						</tr>
					} @else if (stations().length === 0) {
						<tr>
							<td colspan="6" class="px-6 py-8 text-center text-gray-500 dark:text-slate-400">
								No stations found. Try adjusting the filters.
							</td>
						</tr>
					} @else {
						@for (station of stations(); track station.id) {
							<tr>
								<td class="px-6 py-4">
									<div class="font-medium text-gray-900 dark:text-slate-100">{{ station.name }}</div>
									<div class="text-xs text-gray-500 dark:text-slate-400">{{ station.address }}</div>
								</td>
								<td class="px-6 py-4 text-gray-700 dark:text-slate-300">{{ station.city }}</td>
								<td class="px-6 py-4">
									<span class="rounded-full px-3 py-1 text-xs font-semibold" [ngClass]="statusBadge(station.status)">
										{{ station.status }}
									</span>
								</td>
								<td class="px-6 py-4">
									{{ station.chargers.length || 0 }}
								</td>
								<td class="px-6 py-4">
									<div class="text-gray-700 dark:text-slate-300">{{ station.operator?.fullName || '—' }}</div>
									<div class="text-xs text-gray-500 dark:text-slate-400">{{ station.operator?.email }}</div>
								</td>
								<td class="px-6 py-4 text-right">
									<div class="flex justify-end gap-2">
										<a
											[routerLink]="['/stations', station.id]"
											class="rounded-lg border border-gray-200 px-3 py-1.5 text-xs font-medium text-gray-700 hover:bg-gray-50 dark:border-slate-700 dark:text-slate-200 dark:hover:bg-slate-800"
										>
											View
										</a>
										<a
											[routerLink]="['/stations', station.id, 'edit']"
											class="rounded-lg border border-blue-100 px-3 py-1.5 text-xs font-medium text-blue-600 hover:bg-blue-50 dark:border-blue-500/40 dark:text-blue-300 dark:hover:bg-blue-500/10"
										>
											Edit
										</a>
										<button
											type="button"
											(click)="deleteStation(station.id)"
											class="rounded-lg border border-red-100 px-3 py-1.5 text-xs font-medium text-red-600 hover:bg-red-50 dark:border-red-500/40 dark:text-red-300 dark:hover:bg-red-500/10"
										>
											Delete
										</button>
									</div>
								</td>
							</tr>
						}
					}
				</tbody>
			</table>
		</div>

		<div class="flex items-center justify-between border-t border-gray-200 px-6 py-4 text-sm text-gray-600 dark:border-slate-700 dark:text-slate-300">
			<div>
				Page {{ meta().page }} of {{ meta().totalPages }} · {{ meta().total }} total
			</div>
			<div class="flex items-center gap-2">
				<button
					type="button"
					(click)="goToPreviousPage()"
					[disabled]="meta().page === 1"
					class="rounded-lg border border-gray-200 px-3 py-1 text-xs font-medium text-gray-700 disabled:cursor-not-allowed disabled:text-gray-400 dark:border-slate-700 dark:text-slate-200 dark:disabled:text-slate-500"
				>
					Previous
				</button>
				<button
					type="button"
					(click)="goToNextPage()"
					[disabled]="meta().page === meta().totalPages"
					class="rounded-lg border border-gray-200 px-3 py-1 text-xs font-medium text-gray-700 disabled:cursor-not-allowed disabled:text-gray-400 dark:border-slate-700 dark:text-slate-200 dark:disabled:text-slate-500"
				>
					Next
				</button>
			</div>
		</div>
	</div>
</div>
